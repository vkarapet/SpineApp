MMAT Development Startup
========================

Prerequisites: Node.js installed, dependencies installed (npm install in mmat/).

Option A: Dev Mode (live reload, no offline support)
-----------------------------------------------------

1. Start the dev server:

   cd mmat
   npm run dev

   You should see:
     Local:   https://localhost:5173/   (or http:// if no certs)
     Network: https://192.168.x.x:5173/

3. Open the app:
   - On your laptop: https://localhost:5173
   - On your phone (same WiFi): use the Network URL printed above

Note: API calls are handled by a mock proxy in the service worker — no
separate server is needed.

Option B: Production Mode (offline support, add-to-home-screen)
----------------------------------------------------------------

### One-time setup: HTTPS certificates

Service workers (offline caching) require HTTPS. You must set up local
certificates before the PWA will work on your phone.

1. Install mkcert (if not already installed):

   brew install mkcert

2. Install the local CA into your system trust store:

   mkcert -install

   (This may prompt for your password.)

3. Generate certificates for your LAN IP:

   cd mmat
   ./scripts/setup-https.sh

   This creates certificate files in mmat/.certs/

4. Install the CA certificate on your phone:

   Find the CA file:
     mkcert -CAROOT
     (prints the directory — the file is rootCA.pem inside it)

   iPhone:
     a. AirDrop rootCA.pem to your phone
     b. Settings > General > VPN & Device Management > tap the profile > Install
     c. Settings > General > About > Certificate Trust Settings > enable the mkcert CA

   Android:
     a. Transfer rootCA.pem to the phone
     b. Settings > Security > Encryption & credentials > Install a certificate > CA certificate

   You only need to do this once. After this, your phone trusts all
   certificates generated by mkcert on your laptop.

### Running the production app

1. Build the production app:

   cd mmat
   npm run build

2. Start the preview server:

   cd mmat
   npm run preview

   You should see:
     Local:   https://localhost:4173/
     Network: https://192.168.x.x:4173/

4. Open the app on your phone using the Network URL.
   (If the URL shows as "Not Secure", the CA certificate is not yet
   installed on your phone — see the one-time setup above.)

5. The first visit caches all app files via the service worker. After that,
   the app works fully offline — assessments, history, settings all function
   without a network connection. Sync happens when connectivity is restored.

6. To add to your home screen:
   - iPhone: Safari share button > "Add to Home Screen"
   - Android: Chrome menu > "Add to Home Screen" (or "Install App")

   The app will launch in standalone mode (no browser toolbar) and
   work fully offline.

Note: After code changes, you must run "npm run build" again and refresh
the app (or wait for the "New version available" banner).

If your LAN IP changes
-----------------------

Re-run the cert generation script:

   cd mmat
   ./scripts/setup-https.sh

Then rebuild (npm run build) and restart the preview server.
You do NOT need to re-install the CA on your phone — only the server
cert changes, and the phone already trusts your CA.

Shutting Down
-------------

Press Ctrl+C to stop the server.

Removing mkcert (if desired)
-----------------------------

To uninstall the local CA from your system trust store:

   mkcert -uninstall

To remove the CA and key files:

   rm -rf "$(mkcert -CAROOT)"

To uninstall mkcert itself:

   brew uninstall mkcert

Notes
-----

- API sync calls are intercepted by a mock proxy in the service worker.
- Phone access requires both devices on the same WiFi network.
- In production mode, the service worker precaches ~1MB of assets.
  After first load, the app is fully functional offline.
- The .certs/ directory is gitignored — certificates are machine-specific.
